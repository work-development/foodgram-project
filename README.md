# foodgram-project

![foodgram_workflow](https://github.com/work-development/foodgram-project/workflows/foodgram_workflow/badge.svg)

Это онлайн-сервис, где пользователи смогут публиковать рецепты, подписываться на публикации других пользователей, добавлять понравившиеся рецепты в список «Избранное», а перед походом в магазин скачивать сводный список продуктов, необходимых для приготовления одного или нескольких выбранных блюд.

## Функциональность проекта для авторизованных пользователей:
1. Доступна главная страница.
2. Доступна страница другого пользователя.
3. Доступна страница отдельного рецепта.
4. Доступна страница «Мои подписки».

4.1 Можно подписаться и отписаться на странице рецепта.
4.2 Можно подписаться и отписаться на странице автора.
4.3 При подписке рецепты автора добавляются на страницу «Мои подписки» и удаляются оттуда при отказе от подписки.

5. Доступна страница «Избранное».

5.1 На странице рецепта есть возможность добавить рецепт в список избранного и удалить его оттуда.
5.2 На любой странице со списком рецептов есть возможность добавить рецепт в список избранного и удалить его оттуда.

6. Доступна страница «Список покупок».

6.1 На странице рецепта есть возможность добавить рецепт в список покупок и удалить его оттуда.
6.2 На любой странице со списком рецептов есть возможность добавить рецепт в список покупок и удалить его оттуда.
6.3 Есть возможность выгрузить файл (txt или PDF) со перечнем и количеством необходимых продуктов для рецептов из «Списка покупок».
6.4 Ингредиенты в выгружаемом списке не повторяются, корректно подсчитывается общее количество для каждого ингредиента.

7. Доступна страница «Создать рецепт».

7.1 Есть возможность опубликовать свой рецепт.
7.2 Есть возможность отредактировать и сохранить изменения в своём рецепте.
7.3 Есть возможность удалить свой рецепт.

8. Доступна и работает форма изменения пароля.
9. Доступна возможность выйти из системы (разлогиниться).

## Функциональность проекта для неавторизованных пользователей
1. Доступна главная страница.
2. Доступна страница отдельного рецепта.
3. Доступна страница любого пользователя.
4. Доступна и работает форма авторизации.
5. Доступна и работает система восстановления пароля.
6. Доступна и работает форма регистрации.

## Администратор и админ-зона
1. Все модели выведены в админ-зону.
2. Для модели пользователей включена фильтрация по имени и email.
3. Для модели рецептов включена фильтрация по названию.
4. Для модели ингредиентов включена фильтрация по названию.

## Инфраструктура
1. Проект работает с СУБД PostgreSQL.
2. Для проекта настроены Continuous Integration и Continuous Deployment на основе GitHub Actions
3. Проект запущен на сервере в Яндекс.Облаке в трёх контейнерах: nginx, PostgreSQL и Django+Gunicorn.
4. Контейнер с проектом обновляется на Docker Hub.
5. В nginx настроена раздача статики, остальные запросы переадресуются в Gunicorn.
6. Данные сохраняются в volumes.

## Локальный запуск проекта
1. Склонируйте проект
2. Установите PostgreSQL и в pgAdmin создайте БД с именем foodgram
3. В файле .env в переменную POSTGRES_PASSWORD введите пароль PostgreSQL
4. Создайте виртуальное окружение 
```
python -m venv venv
```
5. Запустите виртуальное окружение.
В cmd перейдите в директорию ...\venv\Scripts и выполните команду activate.bat
6. Установите необходимые библиотеки  
```
pip install -r requirements.txt
``` 
7. Сделайте миграции
```
python manage.py makemigrations
python manage.py migrate
```
8. Запустите проект
```
python manage.py runserver
```
Теперь проект будет доступен по адресу http://127.0.0.1:8000

9. Для управления проектом создайте суперпользователя
```
python manage.py createsuperuser
```
Теперь по адресу http://127.0.0.1:8000/admin-page/ будет доступен вход в административный раздел сайта

## Запуск проекта на сервере
1. Склонируйте проект
2. Упакуйте файлы в zip файл (foodgram-project.zip)
3. Установите на сервере Docker и docker-compose
4. Установите утилиту для распаковки ZIP
```
sudo apt install unzip
```
5. Перенесите foodgram-project.zip на сервер и распакуйте его. Для этого локально выполните команду в cmd
```
scp foodgram-project.zip логин_сервера@ID_сервера: /home/логин_сервера/foodgram-project
```
И распакуйте этот файл на сервере, для этого перейдите на сервере в директорию /foodgram-project и выполните команду
```
sudo unzip foodgram-project.zip
```
6. Настройти параметры БД. Перейдите /foodgram-project/foodgram и выполните команду
```
sudo nano .env
```
Измените параметры
```
DB_NAME=postgres
DB_HOST=db
DB_PORT=5432
```
7. Добавьте ID сервера в настройки проекта. Для этого в директории на сервере/foodgram-project/foodgram выполните
```
sudo nano settings.py
```
после чего добавьте Ваш ID в список параметра ALLOWED_HOSTS. Затем в директории /foodgram-project/nginx/nginx.conf выполните
```
sudo nano nginx.conf
```
и добавьте в перечень server_name Ваш ID сервера

8. Запустите docker-compose
```
sudo docker-compose up
```
закройте cmd (не останавливая работу сервера)

9. Выполните миграции в контейнере foodgram-project_web. Для этого выполните команду на сервере, зайдя в него вновь 
```
sudo docker container ls -a
```
что бы узнать CONTAINER_ID. Выполните миграции
```
sudo docker exec CONTAINER_ID python manage.py migrate
```
10. Теперь проект будет доступен по URL Вашего ID сервера
11. Для управления проектом создайте суперпользователя
```
sudo docker exec -ti CONTAINER_ID python manage.py createsuperuser
```
Теперь по адресу ID_сервера/admin-page/ будет доступен вход в административный раздел сайта


## Технологии
* [Python 3.8.5](https://www.python.org/)
* [Django 3.1.3](https://www.djangoproject.com/)
* [PostgreSQL](https://www.postgresql.org/)
* [Docker](https://www.docker.com/)

